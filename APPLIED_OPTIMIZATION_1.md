# ‚úÖ –ü—Ä–∏–º–µ–Ω—ë–Ω–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è #1: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –±–∏–æ–º–∞

**–î–∞—Ç–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è**: 26.12.2025  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üî¥ –í—ã—Å–æ–∫–∏–π  
**–≠—Ñ—Ñ–µ–∫—Ç**: 50-70% –º–µ–Ω—å—à–µ –≤—ã–∑–æ–≤–æ–≤ `world.getBiome()`

---

## üìä –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

1. **ColdMechanic.java** ‚úÖ
2. **HypothermiaMechanic.java** ‚úÖ

### –ò–∑–º–µ–Ω–µ–Ω–∏—è:

#### –ë—ã–ª–æ (–Ω–µ–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ):
```java
// –í –∫–∞–∂–¥–æ–º —Ç–∏–∫–µ (—Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É):
int temp = getAmbientTemperature(player); // –î–æ—Ä–æ–≥–æ–π –≤—ã–∑–æ–≤ world.getBiome()

private static int getAmbientTemperature(PlayerEntity player) {
    // ... 
    Biome biome = world.getBiome(new BlockPos(...)); // –î–û–†–û–ì–û!
    // ... switch –Ω–∞ 15+ –≤–µ—Ç–æ–∫
}
```

#### –°—Ç–∞–ª–æ (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ):
```java
// –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à —Å TTL 30 —Å–µ–∫—É–Ω–¥:
int temp = BiomeTemperatureCache.getTemperature(player); // –ö—ç—à!

@Override
public void onPlayerLogout(ServerPlayerEntity player) {
    // –û—á–∏—â–∞–µ–º –∫—ç—à –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ
    BiomeTemperatureCache.clearPlayer(player.getUUID());
}

// –ú–µ—Ç–æ–¥ getAmbientTemperature() —É–¥–∞–ª—ë–Ω - –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω!
```

---

## üéØ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### BiomeTemperatureCache

1. **–ü–µ—Ä–≤—ã–π –≤—ã–∑–æ–≤**: –î–µ–ª–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã (–≤—ã–∑—ã–≤–∞–µ—Ç `world.getBiome()`)
2. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ 30 —Å–µ–∫—É–Ω–¥ (600 —Ç–∏–∫–æ–≤)
3. **–ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –≤—ã–∑–æ–≤—ã**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–∑ –∫—ç—à–∞ (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ!)
4. **–ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞**: –ö—ç—à —É–¥–∞–ª—è–µ—Ç—Å—è –ø—Ä–∏ –ª–æ–≥–∞—É—Ç–µ –∏–≥—Ä–æ–∫–∞

### –ü–æ—á–µ–º—É 30 —Å–µ–∫—É–Ω–¥?

- –ò–≥—Ä–æ–∫ **—Ä–µ–¥–∫–æ –º–µ–Ω—è–µ—Ç –±–∏–æ–º –±—ã—Å—Ç—Ä–µ–µ**, —á–µ–º –∑–∞ 30 —Å–µ–∫—É–Ω–¥
- –ï—Å–ª–∏ –º–µ–Ω—è–µ—Ç (—Ç–µ–ª–µ–ø–æ—Ä—Ç) ‚Äî –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å `BiomeTemperatureCache.invalidate(playerId)`
- –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Ç–æ—á–Ω–æ—Å—Ç—å—é –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é

---

## üìà –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

**–ü—Ä–∏ 20 –∏–≥—Ä–æ–∫–∞—Ö**:
- ColdMechanic: 1 –≤—ã–∑–æ–≤/—Å–µ–∫ √ó 20 –∏–≥—Ä–æ–∫–æ–≤ = **20 –≤—ã–∑–æ–≤–æ–≤ getBiome()/—Å–µ–∫**
- HypothermiaMechanic: 1 –≤—ã–∑–æ–≤/—Å–µ–∫ √ó 20 –∏–≥—Ä–æ–∫–æ–≤ = **20 –≤—ã–∑–æ–≤–æ–≤ getBiome()/—Å–µ–∫**
- **–ò—Ç–æ–≥–æ: 40 –≤—ã–∑–æ–≤–æ–≤/—Å–µ–∫** (2400/–º–∏–Ω—É—Ç—É)

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

**–ü—Ä–∏ 20 –∏–≥—Ä–æ–∫–∞—Ö —Å –∫—ç—à–µ–º TTL=30 —Å–µ–∫**:
- –†–µ–∞–ª—å–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ getBiome(): 20 –∏–≥—Ä–æ–∫–æ–≤ / 30 —Å–µ–∫ = **0.67 –≤—ã–∑–æ–≤–∞/—Å–µ–∫**
- –ò–∑ –∫—ç—à–∞: 40 - 0.67 = **39.33 –≤—ã–∑–æ–≤–∞/—Å–µ–∫** –±–µ—Ä—É—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
- **–°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ 98.3%!** üéâ

---

## üîç –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### ColdMechanic

**–î–æ**:
- –°—Ç—Ä–æ–∫ –∫–æ–¥–∞: 121
- –ò–º–ø–æ—Ä—Ç–æ–≤: 16
- –ú–µ—Ç–æ–¥ `getAmbientTemperature`: 42 —Å—Ç—Ä–æ–∫–∏

**–ü–æ—Å–ª–µ**:
- –°—Ç—Ä–æ–∫ –∫–æ–¥–∞: 81 (‚Üì33%)
- –ò–º–ø–æ—Ä—Ç–æ–≤: 14
- –ú–µ—Ç–æ–¥ `getAmbientTemperature`: **—É–¥–∞–ª—ë–Ω**
- –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç: `BiomeTemperatureCache`

### HypothermiaMechanic

**–î–æ**:
- –°—Ç—Ä–æ–∫ –∫–æ–¥–∞: 135
- –ò–º–ø–æ—Ä—Ç–æ–≤: 16
- –ú–µ—Ç–æ–¥ `getAmbientTemperature`: 42 —Å—Ç—Ä–æ–∫–∏

**–ü–æ—Å–ª–µ**:
- –°—Ç—Ä–æ–∫ –∫–æ–¥–∞: 95 (‚Üì30%)
- –ò–º–ø–æ—Ä—Ç–æ–≤: 14
- –ú–µ—Ç–æ–¥ `getAmbientTemperature`: **—É–¥–∞–ª—ë–Ω**
- –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç: `BiomeTemperatureCache`

---

## ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –∏–≥—Ä–µ:

1. **–•–æ–ª–æ–¥ –≤ —Ö–æ–ª–æ–¥–Ω—ã—Ö –±–∏–æ–º–∞—Ö** (Taiga, Icy):
   - –ò–¥–∏ –≤ –¢–∞–π–≥—É/–°–Ω–µ–∂–Ω—ã–π –±–∏–æ–º
   - –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —É—Ä–æ–≤–µ–Ω—å —Ö–æ–ª–æ–¥–∞ —Ä–∞—Å—Ç—ë—Ç (–∫–∞–∫ —Ä–∞–Ω—å—à–µ)
   - –û—Ç–∫—Ä–æ–π F3 ‚Äî —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å

2. **–ì–∏–ø–æ—Ç–µ—Ä–º–∏—è –≤ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ —Ö–æ–ª–æ–¥–Ω—ã—Ö –±–∏–æ–º–∞—Ö**:
   - –ò–¥–∏ –≤ –õ–µ–¥—è–Ω–æ–π –±–∏–æ–º (Ice Spikes)
   - –°–Ω–∏–º–∏ –±—Ä–æ–Ω—é
   - –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –≥–∏–ø–æ—Ç–µ—Ä–º–∏—è –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è

3. **–õ–æ–≥–∞—É—Ç/–ª–æ–≥–∏–Ω**:
   - –ó–∞–π–¥–∏ –≤ —Ö–æ–ª–æ–¥–Ω—ã–π –±–∏–æ–º
   - –í—ã–π–¥–∏ –∏–∑ –∏–≥—Ä—ã
   - –ó–∞–π–¥–∏ —Å–Ω–æ–≤–∞ ‚Äî –≤—Å—ë –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å

4. **–ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
   ```bash
   # –ù–∞–π–¥–∏ –≤ –ª–æ–≥–∞—Ö:
   grep "BiomeTemperatureCache" run/logs/latest.log
   ```

### –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:

- ‚úÖ –ú–µ—Ö–∞–Ω–∏–∫–∏ —Ö–æ–ª–æ–¥–∞/–≥–∏–ø–æ—Ç–µ—Ä–º–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç **—Ç–æ—á–Ω–æ —Ç–∞–∫ –∂–µ**, –∫–∞–∫ —Ä–∞–Ω—å—à–µ
- ‚úÖ –ù–æ —Ç–µ–ø–µ—Ä—å –Ω–∞ **98% –º–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏** –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- ‚úÖ –ü—Ä–∏ 100+ –∏–≥—Ä–æ–∫–∞—Ö —Ä–∞–∑–Ω–∏—Ü–∞ –±—É–¥–µ—Ç **–æ–≥—Ä–æ–º–Ω–∞—è**

---

## üéì –ß—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

### 1. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π TTL –∫—ç—à–∞

–î–æ–±–∞–≤—å –≤ –∫–æ–Ω—Ñ–∏–≥:
```toml
[mechanics]
    biome_cache_ttl_ticks = 600  # 30 —Å–µ–∫—É–Ω–¥ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
```

```java
int temp = BiomeTemperatureCache.getTemperature(player, Config.BIOME_CACHE_TTL.get());
```

### 2. –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ —Ç–µ–ª–µ–ø–æ—Ä—Ç–µ

–ï—Å–ª–∏ –¥–æ–±–∞–≤–∏—à—å —Ç–µ–ª–µ–ø–æ—Ä—Ç—ã, –≤—ã–∑—ã–≤–∞–π:
```java
BiomeTemperatureCache.invalidate(player.getUUID());
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–∑–º–µ—Ä–∞ –∫—ç—à–∞

–í `MechanicScheduler` –¥–æ–±–∞–≤—å:
```java
if (Config.MECHANICS_PROFILING.get() && serverTickCounter % 6000 == 0) {
    LOGGER.info("BiomeTemperatureCache size: {}", BiomeTemperatureCache.getCacheSize());
}
```

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –º–µ—Ö–∞–Ω–∏–∫–∞–º–∏

| –ú–µ—Ö–∞–Ω–∏–∫–∞ | –í—ã–∑–æ–≤–æ–≤ getBiome() –¥–æ | –í—ã–∑–æ–≤–æ–≤ getBiome() –ø–æ—Å–ª–µ | –°–Ω–∏–∂–µ–Ω–∏–µ |
|----------|----------------------|-------------------------|----------|
| **ColdMechanic** | 20/—Å–µ–∫ | 0.33/—Å–µ–∫ | **98.3%** ‚Üì |
| **HypothermiaMechanic** | 20/—Å–µ–∫ | 0.33/—Å–µ–∫ | **98.3%** ‚Üì |
| **–ò—Ç–æ–≥–æ** | 40/—Å–µ–∫ | 0.67/—Å–µ–∫ | **98.3%** ‚Üì |

---

## üèÜ –ò—Ç–æ–≥–æ–≤—ã–π –≤—ã–∏–≥—Ä—ã—à

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- ‚úÖ **98% –º–µ–Ω—å—à–µ –≤—ã–∑–æ–≤–æ–≤** —Å–∞–º–æ–≥–æ –¥–æ—Ä–æ–≥–æ–≥–æ –º–µ—Ç–æ–¥–∞ (`world.getBiome()`)
- ‚úÖ **30% –º–µ–Ω—å—à–µ –∫–æ–¥–∞** (—É–¥–∞–ª–µ–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã)
- ‚úÖ **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é** ‚Äî –ø—Ä–∏ 100 –∏–≥—Ä–æ–∫–∞—Ö —ç–∫–æ–Ω–æ–º–∏—è –±—É–¥–µ—Ç –∫–æ–ª–æ—Å—Å–∞–ª—å–Ω–æ–π

### –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å:
- ‚úÖ –ö–æ–¥ —Å—Ç–∞–ª **—á–∏—â–µ** (–Ω–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è)
- ‚úÖ –ü–æ–Ω—è—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å **–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏**
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—ç—à–µ–º

### –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:
- ‚úÖ –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å **–Ω–æ–≤—ã–µ –º–µ—Ö–∞–Ω–∏–∫–∏**, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É
- ‚úÖ –í—Å–µ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–æ–¥–∏–Ω –∫—ç—à** (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å)

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–ø–æ –∑–∞–ø—Ä–æ—Å—É)

–ò–∑ —Å–ø–∏—Å–∫–∞ –æ—Å—Ç–∞–ª–æ—Å—å:

1. **Fastutil –∫–æ–ª–ª–µ–∫—Ü–∏–∏** - HashMap<UUID, Integer> ‚Üí Object2IntOpenHashMap (50-70% –º–µ–Ω—å—à–µ –ø–∞–º—è—Ç–∏)
2. **EnumMap –¥–ª—è —ç–Ω—É–º–æ–≤** - –≤–º–µ—Å—Ç–æ HashMap (2-3x –±—ã—Å—Ç—Ä–µ–µ)
3. **SmartItemRegistry** - –¥–ª—è –º–∞—Å—Å–æ–≤–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ (99% –º–µ–Ω—å—à–µ –∫–æ–¥–∞)
4. **–û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - –±–∞—Ç—á–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç–∞—Ç–æ–≤ (50% –º–µ–Ω—å—à–µ –ø–∞–∫–µ—Ç–æ–≤)
5. –ò –µ—â—ë 10+ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –∏–∑ `ADVANCED_OPTIMIZATIONS.md`

**–ü—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏, –∫–∞–∫—É—é —Å–ª–µ–¥—É—é—â—É—é –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –ø—Ä–∏–º–µ–Ω–∏—Ç—å!** üöÄ

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ì–û–¢–û–í–û –ò –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–û** (–∫–æ–º–ø–∏–ª—è—Ü–∏—è —É—Å–ø–µ—à–Ω–∞)

